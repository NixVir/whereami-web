<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Where Am I? - Cosmic Position Calculator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <div class="spinner"></div>
            <h2>Calculating Your Cosmic Journey...</h2>
            <p id="loading-status">Initializing...</p>
        </div>
    </div>

    <div id="visualization-container"></div>

    <!-- Frame of Reference Indicator -->
    <div id="frame-reference-indicator">
        <strong>Frame of Reference:</strong> Cosmic Microwave Background (CMB)
        <div class="reference-detail">All distances measured relative to the CMB rest frame</div>
    </div>

    <div id="ui-overlay">
        <!-- Header -->
        <header class="app-header">
            <h1>Where Am I?</h1>
            <p class="subtitle">Your Journey Through Space and Time</p>
        </header>

        <!-- Input Form -->
        <div id="input-panel" class="panel">
            <h2>Your Cosmic Journey</h2>
            <p class="form-description">Enter your birthdate or any other date in history:</p>

            <div class="form-section">
                <div class="form-group">
                    <label>Select a date:</label>
                    <div class="date-selector">
                        <select id="birth-year" required>
                            <option value="">Year</option>
                        </select>
                        <select id="birth-month" required>
                            <option value="">Month</option>
                            <option value="01">January</option>
                            <option value="02">February</option>
                            <option value="03">March</option>
                            <option value="04">April</option>
                            <option value="05">May</option>
                            <option value="06">June</option>
                            <option value="07">July</option>
                            <option value="08">August</option>
                            <option value="09">September</option>
                            <option value="10">October</option>
                            <option value="11">November</option>
                            <option value="12">December</option>
                        </select>
                        <select id="birth-day" required>
                            <option value="">Day</option>
                        </select>
                    </div>
                    <input type="hidden" id="birth-date">
                </div>
            </div>

            <button id="calculate-btn" class="primary-button">
                Calculate My Journey
            </button>

            <div class="preset-section">
                <h3>Or Explore Historic & Future Events</h3>

                <div class="preset-category">
                    <h4>Historic Events</h4>
                    <div class="preset-buttons">
                        <button class="preset-button" data-date="1941-12-07" data-name="Pearl Harbor Attack">
                            Pearl Harbor Attack
                        </button>
                        <button class="preset-button" data-date="1066-10-14" data-name="Battle of Hastings">
                            Battle of Hastings
                        </button>
                        <button class="preset-button" data-date="1776-07-04" data-name="Declaration of Independence">
                            Declaration of Independence
                        </button>
                        <button class="preset-button" data-date="-2560-01-01" data-name="Great Pyramid Built">
                            Great Pyramid Built
                        </button>
                    </div>
                </div>

                <div class="preset-category">
                    <h4>Future Events</h4>
                    <div class="preset-buttons">
                        <button class="preset-button" data-date="2044-08-23" data-name="Next Total Solar Eclipse (North America)">
                            Next Total Eclipse (NA)
                        </button>
                        <button class="preset-button" data-date="2250000000-01-01" data-name="Sun's Next Galactic Orbit">
                            Sun's Next Galactic Orbit
                        </button>
                        <button class="preset-button" data-date="4500000000-01-01" data-name="Milky Way-Andromeda Collision">
                            Milky Way-Andromeda Collision
                        </button>
                    </div>
                </div>
            </div>

            <div id="error-message" class="error-message" style="display: none;"></div>
            
            <!-- Hidden fields for defaults -->
            <input type="hidden" id="birth-time" value="12:00">
            <input type="hidden" id="birth-timezone" value="UTC">
            <input type="hidden" id="birth-location" value="New York, NY, USA">
            <input type="hidden" id="use-current-time" value="true">
            <input type="hidden" id="same-location" value="true">
            <input type="hidden" id="current-location" value="">
        </div>

        <!-- Results Panel -->
        <div id="results-panel" class="panel" style="display: none;">
            <button id="back-btn" class="secondary-button">← Enter another birthdate, or any date in history</button>

            <div class="results-header">
                <h2>Distance Traveled Since Birth</h2>
                <p id="journey-summary"></p>
            </div>

            <div class="journey-controls">
                <button id="play-pause-btn" class="control-button primary">
                    <span id="play-pause-icon">▶</span> Play Journey
                </button>
                <button id="reset-camera-btn" class="control-button">Reset Camera</button>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="distance-traveled">0</div>
                    <div class="stat-label">Kilometers Traveled</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="time-elapsed">0</div>
                    <div class="stat-label">Years</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="current-velocity">0</div>
                    <div class="stat-label">km/s (Current Velocity)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="light-years">0</div>
                    <div class="stat-label">Light-Years</div>
                </div>
            </div>

            <div class="cosmic-separation-section">
                <h3>Cosmic Separation</h3>
                <p class="separation-explanation" id="separation-explanation">
                    Your birth position and current position in cosmic space are now separated by:
                </p>
                <div class="separation-stat">
                    <div class="separation-value" id="separation-distance">0</div>
                    <div class="separation-label">Current separation in space</div>
                </div>
                <p class="separation-note">
                    <strong>Note:</strong> Both points are moving together with Earth, the Sun, and our galaxy through space at ~370 km/s. They maintain this separation distance as they travel through the cosmos.
                </p>
            </div>

            <div class="controls-section">
                <h3>Animation Controls</h3>
                <div class="controls">
                    <button id="play-pause-btn" class="control-button">
                        <span id="play-pause-icon">▶</span> Play Journey
                    </button>
                    <button id="restart-btn" class="control-button">↻ Restart</button>
                    <div class="speed-control">
                        <label>Speed: <span id="speed-value">1x</span></label>
                        <input type="range" id="speed-slider" min="0.5" max="5" step="0.5" value="1">
                    </div>
                </div>
                <div class="timeline-control">
                    <label>Journey Timeline</label>
                    <input type="range" id="timeline-slider" min="0" max="100" step="0.1" value="0">
                    <div class="timeline-labels">
                        <span>Birth</span>
                        <span id="timeline-percentage">0%</span>
                        <span>Now</span>
                    </div>
                </div>
            </div>

            <div class="spacecraft-section">
                <h3>Spacecraft Comparison</h3>
                <div id="spacecraft-list"></div>
            </div>

            <button id="show-details-btn" class="secondary-button">
                Show Technical Details
            </button>

            <div id="technical-details" class="technical-details" style="display: none;">
                <h3>Velocity Breakdown</h3>
                <div id="velocity-breakdown"></div>
            </div>
        </div>

        <!-- Info Button -->
        <button id="info-btn" class="info-button" title="About this project">?</button>

        <!-- Info Modal -->
        <div id="info-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2>About Where Am I?</h2>
                <p>This cosmic position calculator shows you how far you've traveled through space since you were born.</p>
                <h3>What's Included:</h3>
                <ul>
                    <li>Earth's rotation (465 m/s at equator)</li>
                    <li>Earth's orbit around the Sun (29.78 km/s)</li>
                    <li>Sun's motion through the Milky Way (230 km/s)</li>
                    <li>Galactic motion through the universe (600+ km/s)</li>
                    <li>Total velocity relative to CMB (369 km/s)</li>
                </ul>
                <p><strong>You're traveling at over 1.3 million km/h through space right now!</strong></p>
                <h3>Technology:</h3>
                <ul>
                    <li>Python + Flask (calculations)</li>
                    <li>Three.js (3D visualization)</li>
                    <li>Astropy (astronomical accuracy)</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Three.js and dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tweenjs/tween.js@23.1.1/dist/tween.umd.js"></script>

    <!-- Our application scripts -->
    <script src="{{ url_for('static', filename='js/orbit-controls.js') }}"></script>
    <script src="{{ url_for('static', filename='js/visualization.js') }}"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
